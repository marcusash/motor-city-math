# Application Agent — Onboarding & Architecture Deep Dive

> **You are Agent A (Application) for Kai's Study Lab.**
> This document is your comprehensive onboarding. Read it fully before writing any code.

---

## 1. What This Project Is

**Kai's Study Lab** is a collection of 12 hand-built HTML practice tests for Algebra II. Marcus (your human lead, CVP of Design at Microsoft) built these with AI assistance to help his 15-year-old son Kai prepare for exams at Seattle Academy (SAAS). **Result: Kai went from struggling to earning an A.**

The tests are self-contained HTML files — no build system, no framework, no server. Open in a browser, work the problems, check your answers. Your job is to evolve this from a file collection into a proper study system while preserving what already works.

**Critical context:** This is a dad building tools for his son. Speed and correctness matter more than architectural purity. If Kai has a test on Friday, shipping a working practice test by Thursday night beats shipping a perfect one on Saturday.

---

## 2. Current Architecture

### Stack
- **Pure HTML/CSS/JS** — no build tools, no npm, no React. This is intentional.
- **Chart.js** (CDN) — Interactive scatter plots and line charts in 7/12 files
- **MathJax** (CDN) — LaTeX math rendering in 4/12 files (migrating to KaTeX)
- **localStorage** — Save/load progress in 7/12 files

### File Inventory (12 tests, ~200 questions, 14,721 LOC)

| File | Unit | Qs | Lines | Auto-grade | Charts | Math | Save/Load |
|------|------|------|-------|-----------|--------|------|-----------|
| `index.html` | Linear Functions | 16 | 1,752 | ✅ | ✅ | — | — |
| `index_calc.html` | Linear Functions (calc) | 16 | 1,392 | ✅ | ✅ | — | — |
| `final_exam_251123.html` | Unit 1 Exam | 18 | 1,666 | — | ✅ | — | ✅ |
| `final_exam_251123_mini.html` | Unit 1 Exam (mini) | 8 | 899 | — | — | — | — |
| `quiz_251117.html` | Inverse Functions | 12 | 836 | — | — | — | — |
| `quiz_251120.html` | Linear & Exponential | 15 | 1,358 | — | ✅ | — | ✅ |
| `quiz_251121.html` | Linear & Exponential | 21 | 1,526 | — | ✅ | — | ✅ |
| `nonlinear_functions_test.html` | Non-Linear Functions | 16 | 1,666 | — | ✅ | ✅ | — |
| `exponents_exam.html` | Exponents Mastery | 18 | 764 | — | — | — | ✅ |
| `20260119_Exponents_Unit1.html` | Exponents Unit 1 | 20 | 929 | — | — | — | ✅ |
| `20260119_Exponents_Unit1_2nd.html` | Exponents Unit 1 v2 | 20 | 962 | — | — | — | ✅ |
| `20260119_Exponents_Unit1_3rd.html` | Exponents Unit 1 v3 | 20 | 971 | — | — | — | ✅ |

### What's Duplicated (~4,000 lines)
- **~250 lines of CSS** copied across all 12 files (nearly identical)
- **~100 lines of JS** copied across files (answer key toggle, save/load, print)
- The CSS and JS are the same *concept* in every file but have minor per-file variations

### Current Patterns

**Question card HTML pattern (repeated ~200 times):**
```html
<div class="question-card">
    <h3>QUESTION 1 — STANDARD 3.A</h3>
    <p>Given f(x) = 2x + 1 and g(x) = x², find (f ∘ g)(3).</p>
    <input type="text" id="q1" placeholder="Enter answer">
    <div class="answer-feedback" id="fb1" style="display:none">
        <p class="correct">✓ Correct! (f ∘ g)(3) = f(g(3)) = f(9) = 19</p>
    </div>
</div>
```

**Answer key pattern:**
```javascript
function showAnswerKey() {
    document.getElementById('answer-key-overlay').style.display = 'flex';
}
function closeAnswerKey() {
    document.getElementById('answer-key-overlay').style.display = 'none';
}
```

**Auto-grading pattern (only in 2 files):**
```javascript
function check() {
    let score = 0;
    const total = 16;
    // For each question: get input, compare to expected, show feedback
    const q1 = parseFloat(document.getElementById('q1').value);
    if (Math.abs(q1 - 19) < 0.01) { score++; showCorrect('fb1'); }
    else { showIncorrect('fb1'); }
    // ... repeat for all questions
    document.getElementById('score').textContent = score + '/' + total;
}
```

**Save/load pattern (7 files):**
```javascript
function saveResults() {
    const data = {};
    document.querySelectorAll('input').forEach(input => {
        data[input.id] = input.value;
    });
    localStorage.setItem('test-name', JSON.stringify(data));
}
```

---

## 3. Target Architecture

### Directory Structure (migrate to)

```
kai-algebra2-tests/
├── index.html                  ← Dashboard (NEW — test index, scores, progress)
├── shared/
│   ├── styles.css              ← Design system as CSS (from .design-system.md)
│   ├── scripts.js              ← Grading engine, answer key, save/load, streak
│   ├── chart-theme.js          ← Chart.js defaults (Pistons palette)
│   └── print.css               ← Print-specific overrides
├── tests/
│   ├── unit1-exponents/
│   │   ├── v1.html             ← Renamed from 20260119_Exponents_Unit1.html
│   │   ├── v2.html
│   │   ├── v3.html
│   │   └── exam.html           ← Renamed from exponents_exam.html
│   ├── unit2-linear/
│   │   ├── practice.html       ← Renamed from index.html
│   │   ├── practice-calc.html
│   │   ├── final.html
│   │   └── final-mini.html
│   ├── unit3-exponential/
│   │   ├── quiz-1.html
│   │   └── quiz-2.html
│   └── unit4-nonlinear/
│       └── test.html
├── data/
│   ├── questions.json          ← Question bank (from Research agent)
│   └── standards.json          ← SAAS Algebra II standards
└── docs/
    ├── .design-system.md
    ├── .project-review.md
    ├── .agents.md
    ├── .agent-protocol.md
    └── .agent-status.md
```

### Migration Strategy

**DO NOT refactor all 12 files at once.** Migrate one file at a time:

1. Create `shared/styles.css` by extracting CSS from `index.html` (the best file)
2. Create `shared/scripts.js` by extracting JS from `index.html`
3. Test: `index.html` works with external CSS/JS (no inline)
4. Migrate `index_calc.html` to use shared files
5. Test: both files work
6. Continue one-by-one, verifying each
7. After all 12 migrated, create directory structure and rename

**Why one at a time:** Marcus and Kai are actively using these tests. A broken test during a study session is unacceptable. Each migration must be verified before moving to the next.

---

## 4. Skills You Need

### HTML/CSS/JS (Expert Level)
- **No framework.** You're writing vanilla JS. No React, no Vue, no build tools.
- **DOM manipulation:** `document.getElementById`, `querySelectorAll`, event listeners
- **CSS architecture:** Extracting shared styles while preserving per-file overrides
- **Print CSS:** `@media print` rules, `break-inside: avoid`, hiding interactive elements
- **Responsive design:** Flexbox, media queries, mobile-first thinking
- **localStorage API:** `setItem`, `getItem`, `JSON.stringify/parse`

### Math Rendering
- **KaTeX:** Fast LaTeX rendering. Replacing MathJax in 4 files. Syntax: `\\(x^2\\)` for inline, `\\[x^2\\]` for display.
- **Auto-render extension:** Scans DOM and renders all LaTeX automatically
- **Know the difference:** `$x^2$` (MathJax dollar-sign mode) vs `\\(x^2\\)` (KaTeX mode)

### Chart.js
- **Version 4.x** (CDN loaded)
- **Scatter plots:** For graphing questions (plot points, regression lines)
- **Line charts:** For function visualization
- **Custom theming:** Override defaults for Pistons color palette
- **Responsive:** Charts must resize on mobile

### Auto-Grading Logic
- **Numeric comparison with tolerance:** `Math.abs(student - expected) < epsilon`
- **String comparison:** Normalize whitespace, case-insensitive for text answers
- **Multiple correct forms:** `x = 3` and `3` and `x=3` should all be accepted
- **Expression equivalence:** `2x + 4` and `4 + 2x` are the same (harder — may need symbolic comparison)
- **Graph answers:** "Click the correct point" or "identify the vertex" — may need coordinate comparison
- **Multi-part questions:** Some questions have parts (a), (b), (c) with independent grading

### Design System Implementation
- **Read `.design-system.md` thoroughly** — it's your CSS spec
- **Color migration:** Replace all `#8B1E3F` (burgundy) with `#C8102E` (Pistons red)
- **Component patterns:** Buttons (primary/secondary/ghost), inputs, score cards, question cards
- **WCAG compliance:** All color pairs pass AA contrast (verified in design system §2)
- **Dark mode:** CSS custom properties with `prefers-color-scheme` or manual toggle

---

## 5. Working with the Team

### Research Agent (R) — Your Most Important Partner
- **R owns math accuracy.** Every answer key, every grading tolerance, every step-by-step solution comes from R.
- **Never change an answer** without R's verification. If grading seems wrong, file a bug — don't fix the math yourself.
- **R delivers `data/questions.json`.** You consume it. The schema is R's to define, but negotiate early — you need to know the shape to build the renderer.

### Design Agent (D)
- **D owns the visual spec.** `.design-system.md` is your CSS bible.
- **Don't improvise visual decisions.** If the spec doesn't cover something, ask D.
- **D will review your CSS** — expect feedback on spacing, color, typography.

### Fundamentals Agent (F)
- **F will test everything you build.** Auto-grading, print layout, mobile, cross-browser.
- **F catches regressions.** If a migration breaks a file, F files a bug. Fix it immediately.
- **F needs testable code.** Grading functions should be pure (input → output) so F can unit test them.

### Security Agent (S)
- **S owns the localStorage schema.** Coordinate on save/load format.
- **S will audit your data handling.** Make sure progress data can't be corrupted.

### Platform Agent (P)
- **P manages the repo structure.** File naming, directory layout, README.
- **P runs the status board.** Update your section in `.agent-status.md` after every task.

---

## 6. Quality Checklist (Before Marking Anything DONE)

- [ ] Opens in Chrome with no console errors
- [ ] All interactive features work (grading, answer key, save/load, charts)
- [ ] `Ctrl+P` produces clean printable output
- [ ] Mobile layout works at 375px width (iPhone SE)
- [ ] KaTeX equations render correctly (if applicable)
- [ ] Colors match `.design-system.md` (no stale burgundy)
- [ ] Research agent has verified answer accuracy (for grading changes)
- [ ] Committed with descriptive message
- [ ] Status board updated

---

## 7. Common Pitfalls (from Inkwell experience)

1. **Don't refactor everything at once.** The Inkwell project shipped 229 commits in small, verified batches. One file at a time. Test after each change.

2. **Preserve what works.** These 12 tests already helped Kai get an A. Don't break working tests in pursuit of cleaner code. Migration is a means, not an end.

3. **Print support breaks silently.** You won't notice until someone tries to print. Test `Ctrl+P` after every CSS change.

4. **CDN dependencies can fail.** KaTeX and Chart.js load from CDN. If CDN is down, the test is broken. Plan for offline fallback (bundle locally or graceful degradation).

5. **Math rendering order matters.** KaTeX auto-render must run AFTER the DOM is loaded. If you load scripts in `<head>`, equations won't render. Use `defer` or `DOMContentLoaded`.

6. **Answer tolerance is tricky.** `0.01` epsilon works for most numeric answers, but some questions expect exact fractions or expressions. Coordinate with Research agent on per-question tolerances.

7. **localStorage can be full.** On some browsers/devices, localStorage is limited to 5-10MB. Don't store question text — just answers, scores, and timestamps.

8. **Dark mode + print conflict.** Arena Mode (dark theme) must NOT affect print output. Print should always be black on white regardless of theme.

---

## 8. First Tasks (Priority Order)

1. **Read all project files:** `.design-system.md`, `.project-review.md`, `.agent-protocol.md`, `.agents.md`
2. **Open all 12 HTML tests** in a browser. Click through each one. Note what works and what doesn't.
3. **A-1: Extract shared CSS** from the best file (`index.html`) into `shared/styles.css`
4. **A-2: Extract shared JS** into `shared/scripts.js`
5. **A-3: Migrate `index.html`** to use external CSS/JS. Verify it still works identically.
6. **A-4: Migrate `index_calc.html`** (similar to `index.html`, should be easy)
7. **Continue migrations** one file at a time
8. **A-6: Build auto-grading engine** that works for all question types
9. **A-8: Build dashboard** (`index.html` → test index with scores)

---

## 9. Key Decisions Already Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Build tools | None (v1) | Pure HTML/CSS/JS. Open-in-browser. No npm, no bundler. |
| Math rendering | KaTeX (not MathJax) | 10x faster, 6x smaller bundle. See `.design-system.md` §8 |
| Color palette | Detroit Pistons (#C8102E, #1D42BA, #002D62) | Kai's favorite team. Design system is Pistons-inspired. |
| Grading | Client-side only | No server. All grading happens in the browser with JS. |
| Data persistence | localStorage | Simple, offline-first, no accounts needed. |
| Question bank | JSON file | Consumed by JS at runtime. Enables randomization. |
| Print support | First-class feature | Every test prints cleanly. `@media print` in every file. |

---

## 10. Lessons Learned from Inkwell (Applied Here)

The Inkwell project (private TUI journal app) ran 6 agents over 31 hours and produced 229 commits, 529 tests, and 5,400+ LOC. Here's what we learned, adapted for this project:

1. **Small commits, frequent verification.** Don't batch 5 files into one commit. Commit each migration separately so you can revert cleanly.

2. **The status board prevents stalls.** Update `.agent-status.md` after every task. Other agents check it to know what's ready for them.

3. **File ownership prevents conflicts.** Check `.agents.md` before editing any file. If you need a change to someone else's file, request it in the status board.

4. **The human tests the product, not just the code.** Marcus will open these tests and use them with Kai. Bugs Marcus finds in use are higher priority than theoretical issues.

5. **Fundamentals agent is your safety net.** Let F write tests for your grading logic. You build the features, F verifies the math works.

6. **Research agent is your source of truth for content.** Never guess at an answer. If you're unsure whether `f(g(3)) = 19` or `f(g(3)) = 17`, ask R. Math errors are blockers.

7. **Design agent specs save rework.** Read `.design-system.md` before writing CSS. It's comprehensive. Don't improvise — follow the spec.

---

*Welcome to the team. Let's help Kai ace the next exam.*
