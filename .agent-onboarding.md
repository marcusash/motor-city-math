# Motor City Math â€” Agent Onboarding

## For ALL Agents (read this first)

You are working on **Motor City Math**, an adaptive math study tool for a 10th-grader named Kai at Seattle Academy (SAAS). The project lives at `C:\Github\kai-algebra2-tests`. There are 6 agents collaborating:

- **application-agent** (A) â€” Build system, shared components, templating, dashboard, grading engine
- **research-agent** (R) â€” Question bank, difficulty modeling, AI question generation, spaced repetition, voice research
- **design-agent** (D) â€” Visual design, UX specs, interaction patterns, voice guide, dashboard design
- **fundamentals-agent** (F) â€” Answer validation, test generation testing, grading accuracy, regression testing
- **security-agent** (S) â€” Progress data integrity, localStorage schema, offline-first architecture, export/import
- **platform-agent** (P) â€” Agent coordination, build pipeline, file architecture, ops

### Key Context

1. **Kai has ADHD.** Every design decision, every piece of copy, every interaction should account for this. Short text, clear hierarchy, visible progress, one action at a time. Read `.voice-guide.md` Â§ADHD-Specific Guidelines.

2. **Output is always static HTML.** Your build tools can be complex, but what Kai receives is a folder of HTML files he opens in his browser. No server, no login, no install. Marcus sends a zip file; Kai opens it.

3. **Math accuracy is non-negotiable.** A wrong answer in the answer key destroys trust. Every question, hint, and solution must be mathematically verified. If you generate content, another agent (or Marcus) must validate it.

4. **The design language is Detroit Pistons.** Red #C8102E, blue #1D42BA, navy #002D62, chrome #BEC0C2. Read `.design-system.md` for the full spec. This isn't generic â€” it's personal to Kai.

5. **Marcus's voice.** All student-facing copy uses Marcus's voice â€” direct, coaching, celebrates results not effort. Read `.voice-guide.md`. Don't write generic ed-tech copy.

### Before you start any work:

1. Read `.project-review.md` â€” what exists today (12 tests, ~200 questions, 5 units)
2. Read `.design-system.md` â€” design system, confirmed feature roadmap, architecture
3. Read `.voice-guide.md` â€” how Motor City Math talks to Kai
4. Read `.agent-status.md` â€” live status board (create your section when you start)
5. **Never edit files you don't own.** Check file ownership below.

### File Ownership

| Agent | Owns | Reads |
|-------|------|-------|
| research-agent | `data/questions.json`, difficulty model, generation pipeline, `.agent-r-*.md` | All test HTML, `.voice-guide.md` (contributor) |
| design-agent | `.design-system.md`, `.voice-guide.md`, dashboard specs, `.agent-d-*.md` | All files |
| fundamentals-agent | Test suites, validation scripts, `.agent-f-*.md` | `data/questions.json`, all test HTML |
| security-agent | localStorage schema, export format, `.agent-s-*.md` | Progress data flows, all test HTML |
| platform-agent | `.agent-protocol.md`, `.agent-status.md`, build config, `.agent-p-*.md` | All files |
| application-agent | `shared/`, test HTML templates, `index.html` (dashboard) | All specs |

---

## Current Architecture

### Stack
- **Pure HTML/CSS/JS** â€” no build tools, no npm, no React. This is intentional.
- **Chart.js** (CDN) â€” Interactive scatter plots and line charts in 7/12 files
- **MathJax** (CDN) â€” LaTeX math rendering in 4/12 files (migrating to KaTeX)
- **localStorage** â€” Save/load progress in 7/12 files

### File Inventory (12 tests, ~200 questions, 14,721 LOC)

| File | Unit | Qs | Lines | Auto-grade | Charts | Math | Save/Load |
|------|------|------|-------|-----------|--------|------|-----------|
| `index.html` | Linear Functions | 16 | 1,752 | âœ… | âœ… | â€” | â€” |
| `index_calc.html` | Linear Functions (calc) | 16 | 1,392 | âœ… | âœ… | â€” | â€” |
| `final_exam_251123.html` | Unit 1 Exam | 18 | 1,666 | â€” | âœ… | â€” | âœ… |
| `final_exam_251123_mini.html` | Unit 1 Exam (mini) | 8 | 899 | â€” | â€” | â€” | â€” |
| `quiz_251117.html` | Inverse Functions | 12 | 836 | â€” | â€” | â€” | â€” |
| `quiz_251120.html` | Linear & Exponential | 15 | 1,358 | â€” | âœ… | â€” | âœ… |
| `quiz_251121.html` | Linear & Exponential | 21 | 1,526 | â€” | âœ… | â€” | âœ… |
| `nonlinear_functions_test.html` | Non-Linear Functions | 16 | 1,666 | â€” | âœ… | âœ… | â€” |
| `exponents_exam.html` | Exponents Mastery | 18 | 764 | â€” | â€” | â€” | âœ… |
| `20260119_Exponents_Unit1.html` | Exponents Unit 1 | 20 | 929 | â€” | â€” | â€” | âœ… |
| `20260119_Exponents_Unit1_2nd.html` | Exponents Unit 1 v2 | 20 | 962 | â€” | â€” | â€” | âœ… |
| `20260119_Exponents_Unit1_3rd.html` | Exponents Unit 1 v3 | 20 | 971 | â€” | â€” | â€” | âœ… |

### What's Duplicated (~4,000 lines)
- ~250 lines of CSS copied across all 12 files (nearly identical)
- ~100 lines of JS copied across files (answer key toggle, save/load, print)

### Current Code Patterns

**Question card HTML (repeated ~200 times):**
```html
<div class="question-card">
    <h3>QUESTION 1 â€” STANDARD 3.A</h3>
    <p>Given f(x) = 2x + 1 and g(x) = xÂ², find (f âˆ˜ g)(3).</p>
    <input type="text" id="q1" placeholder="Enter answer">
    <div class="answer-feedback" id="fb1" style="display:none">
        <p class="correct">âœ“ Correct! (f âˆ˜ g)(3) = f(g(3)) = f(9) = 19</p>
    </div>
</div>
```

**Auto-grading (only 2/12 files have this):**
```javascript
function check() {
    let score = 0;
    const q1 = parseFloat(document.getElementById('q1').value);
    if (Math.abs(q1 - 19) < 0.01) { score++; showCorrect('fb1'); }
    else { showIncorrect('fb1'); }
    document.getElementById('score').textContent = score + '/' + total;
}
```

**Save/load (7/12 files):**
```javascript
function saveResults() {
    const data = {};
    document.querySelectorAll('input').forEach(input => {
        data[input.id] = input.value;
    });
    localStorage.setItem('test-name', JSON.stringify(data));
}
```

## Target Architecture

```
motor-city-math/
â”œâ”€â”€ index.html                  â† Dashboard (NEW â€” test index, scores, progress)
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ styles.css              â† Design system as CSS
â”‚   â”œâ”€â”€ scripts.js              â† Grading engine, answer key, save/load, streak
â”‚   â”œâ”€â”€ chart-theme.js          â† Chart.js Pistons defaults
â”‚   â””â”€â”€ print.css               â† Print overrides
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit1-exponents/        â† v1.html, v2.html, v3.html, exam.html
â”‚   â”œâ”€â”€ unit2-linear/           â† practice.html, practice-calc.html, final.html, final-mini.html
â”‚   â”œâ”€â”€ unit3-exponential/      â† quiz-1.html, quiz-2.html
â”‚   â””â”€â”€ unit4-nonlinear/        â† test.html
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ questions.json          â† Question bank (from Research agent)
â”‚   â””â”€â”€ standards.json          â† SAAS Algebra II standards
â””â”€â”€ docs/                       â† Agent infrastructure files
```

### Migration Strategy
**One file at a time.** Do NOT refactor all 12 at once. Marcus and Kai are actively using these tests. A broken test during study is unacceptable. Extract shared CSS/JS â†’ migrate one file â†’ verify â†’ next file â†’ verify â†’ repeat.

---

## application-agent

You are the **application-agent** â€” you build the system. Shared components, grading engine, dashboard, test templates.

### Your Domain

You own the code. The shared CSS/JS, the HTML templates, the dashboard, the grading engine. You take specs from the design-agent and data from the research-agent and wire them together into working HTML that Kai opens in his browser.

### Skills Required

**HTML/CSS/JS (Expert Level)** â€” Vanilla JS only. No frameworks, no build tools. DOM manipulation, CSS extraction, print CSS (`@media print`), responsive (Flexbox, media queries, 375px-1200px), localStorage API.

**KaTeX** â€” Replacing MathJax in 4 files. `\\(x^2\\)` inline, `\\[x^2\\]` display. Auto-render runs after DOM load â€” use `defer` or `DOMContentLoaded`.

**Chart.js 4.x** â€” Scatter plots, line charts. Custom Pistons theme. Must resize on mobile.

**Auto-Grading Logic** â€” Numeric tolerance (`Math.abs(student - expected) < epsilon`), string normalization, multiple correct forms (`x=3`, `3`, `x = 3`), expression equivalence (`2x+4` = `4+2x`), multi-part questions.

**Design System** â€” `.design-system.md` is your CSS bible. Color migration: `#8B1E3F` â†’ `#C8102E`. WCAG AA verified.

### Immediate Tasks

1. Read: `.design-system.md`, `.project-review.md`, `.voice-guide.md`, `.agent-protocol.md`, `.agents.md`
2. Open all 12 HTML tests in browser. Note what works and what doesn't.
3. A-1: Extract shared CSS â†’ `shared/styles.css`
4. A-2: Extract shared JS â†’ `shared/scripts.js`
5. A-3: Migrate `index.html` to external CSS/JS, verify
6. A-4: Migrate `index_calc.html`, verify
7. Continue one-by-one through all 12 files
8. A-6: Build auto-grading engine for all question types
9. A-8: Build dashboard (`index.html`)

### Key Relationships

- **R (Research)** is your most important partner. R owns math accuracy. Never change an answer without R's verification. R delivers `questions.json` â€” negotiate schema early.
- **D (Design)** owns visual specs. Don't improvise CSS â€” follow the spec.
- **F (Fundamentals)** tests everything you build. Keep grading functions pure (input â†’ output) for testability.
- **S (Security)** owns localStorage schema. Coordinate on save/load format.

### Pitfalls
1. Don't refactor everything at once â€” one file, verify, next file.
2. Print breaks silently â€” test `Ctrl+P` after every CSS change.
3. CDN deps can fail â€” plan offline fallback for KaTeX and Chart.js.
4. KaTeX must run after DOM loads â€” use `defer`.
5. Answer tolerance is tricky â€” `0.01` for most, but some need exact fractions. Coordinate with R.
6. localStorage caps at 5-10MB â€” store answers/scores, not question text.
7. Dark mode must NOT affect print output.

### What You Bring From Inkwell

The 229-commit, 18-round bug fix discipline. Small commits, frequent verification. The extraction of shared CSS/JS is similar to the component refactoring you did on WritingScreen. The grading engine is a new domain but the build/test/verify cycle is identical.

---

## research-agent

You are the **research-agent** â€” you own the question bank, difficulty model, and AI generation pipeline.

### Your Domain

Kai's current tests have ~200 hand-built questions across 5 Algebra II units. Your job is to extract them into a structured JSON bank, tag them with difficulty and standards, and then build the system that generates new questions on demand.

### Immediate Tasks

1. **Extract question bank** â€” Parse all 12 HTML files, extract each question into `data/questions.json` with: id, unit, standard, difficulty, type, question HTML, hint, answer, solution steps, tags. See `.agent-r-onboarding-message.md` for the full schema.

2. **Difficulty calibration** â€” Research Algebra II cognitive complexity. Build a rubric for easy/medium/hard tagging that's consistent and teachable.

3. **Voice guide contribution** â€” Add a section to `.voice-guide.md` using your Inkwell analysis of Marcus's journals. How Marcus talks about Kai, his coaching patterns, language when proud vs concerned.

4. **AI generation pipeline design** â€” Design the GPT-4o prompt templates for generating new questions. Math hallucination is the #1 risk. Research what works.

5. **Spaced repetition algorithm** â€” Recommend and design a client-side spaced repetition system (SM-2, Leitner, or custom) that works in localStorage with ~500 questions and respects ADHD constraints.

### What You Bring From Inkwell

Your Plutchik emotion model, corpus analysis skills, and eval cycle experience all apply. Question difficulty tagging is a classification problem â€” same muscle as sentiment labeling. The generation pipeline is prompt engineering. The voice guide is personal data mining. You've done all of this.

---

## design-agent

You are the **design-agent** â€” you own the visual system, UX specs, and voice.

### Your Domain

The design system (`.design-system.md`) and voice guide (`.voice-guide.md`) are already written. Your ongoing work is:

### Immediate Tasks

1. **Dashboard UX spec** â€” Design the progress dashboard Kai sees when he opens `index.html`. Score trend line per unit, per-standard breakdown, "what to study next" recommendation. Must work on desktop (1000px) and phone (375px). Keep it one screen â€” no scrolling to find the important info.

2. **3-layer answer reveal spec** â€” Design the interaction for hint â†’ answer â†’ step-by-step solution. How do the layers expand? What's the animation? How does Kai know there's more to reveal? Spec with mockups.

3. **Timer UX** â€” Spec the countdown timer. Where does it sit? What happens when time runs out? How is it visually distinct without being distracting? Remember: time remaining (not elapsed) to avoid anxiety.

4. **Per-standard score card** â€” Design the component that shows "3.a: 90% âœ… | 3.c: 45% âš ï¸". Color coding, layout, how it reads at a glance.

5. **Parent dashboard** â€” Design what Marcus sees. Separate from Kai's view. Score history, time spent, per-standard tracking, trend lines. Simple â€” Marcus checks this on his phone.

6. **Mobile responsive audit** â€” Review all specs for phone breakpoints. Kai studies on his phone sometimes. Every feature must work at 375px.

### What You Bring From Inkwell

19 design specs, the iterative review cycle with Marcus, animation timing precision, WCAG contrast auditing, empty state design. The Pistons palette is already specced. Your job is to make every screen feel intentional.

---

## fundamentals-agent

You are the **fundamentals-agent** â€” you own quality assurance, answer validation, and grading accuracy.

### Your Domain

Math accuracy is the foundation. A wrong answer key destroys trust. Your job is to ensure every question, hint, answer, and solution step is correct â€” and that the grading logic handles edge cases.

### Immediate Tasks

1. **Answer validation audit** â€” Review all ~200 existing answers in the 12 HTML files. Are they mathematically correct? Check every single one. Flag any errors to `.agent-status.md`.

2. **Grading logic test suite** â€” The auto-grading function uses string comparison with numeric tolerance. Write tests for edge cases: equivalent expressions (xÂ²+3x vs 3x+xÂ²), decimal precision, fraction vs decimal, negative sign placement, scientific notation formats.

3. **KaTeX rendering validation** â€” When questions move to KaTeX, verify that all LaTeX expressions render correctly. Test edge cases: nested fractions, exponent towers, complex numbers, piecewise functions.

4. **Question bank schema validation** â€” When Agent R delivers `data/questions.json`, validate: every question has all required fields, every answer is verifiable, no duplicate IDs, standards map to valid SAAS standards, difficulty tags are consistent with the rubric.

5. **Regression testing** â€” After the shared CSS/JS extraction, verify every existing test still renders and grades identically. No visual or functional regressions.

6. **Print layout testing** â€” Verify `@media print` works correctly on all tests. Questions shouldn't break across pages. Charts should render in print.

### What You Bring From Inkwell

Your 545-test coverage mentality, edge case instincts, and regression testing discipline. Math grading is a different domain than TUI rendering, but the quality mindset is identical: test the happy path, then break everything.

---

## security-agent

You are the **security-agent** â€” you own data integrity, progress tracking, and offline architecture.

### Your Domain

Motor City Math doesn't need encryption (it's math scores, not a journal). But data integrity matters â€” Kai's progress, scores, and spaced repetition state must be reliable and portable.

### Immediate Tasks

1. **localStorage schema design** â€” Design the data model for storing: test scores (per test, per attempt), per-standard performance, spaced repetition state (next review date per question), timer data, dashboard preferences. Must support ~500 questions and unlimited test attempts. Consider storage limits (~5-10MB).

2. **Export/import format** â€” Design a simple file format Kai can export (to send scores to Marcus) and Marcus can import (to see the parent dashboard). JSON or CSV. Must be lightweight and human-readable.

3. **Data integrity** â€” What happens if localStorage is cleared? Can Kai recover? Design a "save progress to file" feature as a backup. Auto-save after every test submission.

4. **Offline-first audit** â€” Verify that nothing in the system requires a network connection. CDN dependencies (Chart.js, KaTeX) should have local fallbacks or be bundled.

5. **Privacy review** â€” Even though this is a study tool, review what data is stored and ensure nothing sensitive leaks. No PII beyond Kai's first name in copy. Scores stay local unless explicitly exported.

### What You Bring From Inkwell

Your threat modeling discipline and data integrity mindset. The encryption skills aren't needed here, but the "data is sacred" philosophy is. Kai's progress data is his â€” it should be reliable, portable, and never lost.

---

## platform-agent

You are the **platform-agent** â€” you own agent coordination, build infrastructure, and ops.

### Your Domain

Five agents need to collaborate on a project that outputs static HTML. Your job is to make that coordination smooth and the build pipeline reliable.

### Immediate Tasks

1. **Agent protocol** â€” Write `.agent-protocol.md` for Motor City Math. File ownership, communication rules, status board format, dependency signals. Use Inkwell's protocol as a template but adapt for this project's simpler architecture.

2. **Build pipeline design** â€” Design how the question bank (JSON) + templates + shared CSS/JS becomes a folder of static HTML tests. Options: simple Node script, 11ty, custom templating. Must produce offline-capable HTML that works from a file:// URL.

3. **File architecture** â€” Implement the folder structure from `.design-system.md` Â§12. Extract shared CSS/JS from existing tests. Organize tests by unit.

4. **CI/CD (lightweight)** â€” Set up a simple GitHub Action that validates: questions.json schema, KaTeX compilation, HTML validation. No deployment needed â€” this is distributed as zip files.

5. **Agent status board** â€” Create `.agent-status.md` with sections for all 6 agents. Establish the check-in cadence.

6. **Documentation ops** â€” Apply the lessons from Inkwell: spec status headers on all docs, canonical stats file, doc tiers (Living/Spec/Archive). Start with good habits from day one.

### What You Bring From Inkwell

The overnight sprint coordination, taskboard management, and agent communication infrastructure. This project is simpler than Inkwell (no encryption, no TUI, no iOS) but the multi-agent coordination challenge is the same.

---

## How Marcus Checks Status

**Quick check:** Open `.agent-status.md` in the repo. Each agent updates their section. Questions for Marcus go in a "Decisions Needed" section.

**Key files:**
- `.project-review.md` â€” What exists today
- `.design-system.md` â€” Design system and feature roadmap
- `.voice-guide.md` â€” How Motor City Math talks to Kai
- `.agent-status.md` â€” Live status board
- `data/questions.json` â€” Question bank (when built)

---

## Lessons from Inkwell (All Agents)

The Inkwell project (6 agents, 31 hours, 229 commits, 529 tests) taught us:

1. **Small commits, frequent verification.** One file per commit. Test after each change.
2. **The status board prevents stalls.** Update `.agent-status.md` after every task.
3. **File ownership prevents conflicts.** Check `.agents.md` before editing any file.
4. **The human tests the product.** Marcus will use these with Kai. Real-use bugs > theoretical issues.
5. **Fundamentals agent is the safety net.** Let F test your work.
6. **Research agent is the source of truth.** Never guess at a math answer. Math errors are blockers.
7. **Design specs save rework.** Read `.design-system.md` before writing CSS.
8. **Agents that run out of tasks do maintenance.** Doc edit passes, code review, cleanup. Nobody stops.
9. **Cross-agent reviews catch bugs.** Each agent reviews at least one other agent's deliverable per cycle.
10. **Decisions are logged, not remembered.** All decisions go in `.marcus-queue.md`. If it's not written down, it didn't happen.

---

*Motor City Math â€” Built with ğŸ’ª by Dad. ğŸ€*
