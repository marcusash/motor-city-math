# Motor City Math ‚Äî Accessibility Spec (D-12)

**Author:** Design Agent
**Date:** 2026-02-17
**Status:** proposed
**Standard:** WCAG 2.1 AA
**Blocking:** Agent A ‚Üí accessibility implementation during shared CSS/JS extraction

---

## Audit Summary

| Category | Current | Target |
|----------|---------|--------|
| `lang` attribute | ‚úÖ All 12 files | ‚úÖ |
| Focus styles | ‚ö†Ô∏è Partial (inputs only) | All interactive elements |
| Label-input association | ‚ùå No `for=` attributes | All inputs labeled |
| ARIA attributes | ‚ùå None | Key landmarks + live regions |
| Heading hierarchy | ‚ö†Ô∏è Unchecked | h1‚Üíh2‚Üíh3 no skips |
| Button names | ‚ö†Ô∏è No aria-labels | All buttons named |
| Form grouping | ‚ùå No fieldset/legend | Multi-part questions grouped |
| Color-only indicators | ‚ö†Ô∏è Some | Text + icon with every color |
| Keyboard navigation | ‚ùå No tabindex management | Full keyboard flow |
| Screen reader support | ‚ùå No roles/regions | Landmark roles, live regions |

---

## 1. Focus Indicators

Every interactive element must have a visible focus ring.

```css
/* Universal focus style */
:focus-visible {
    outline: 3px solid var(--accent-blue, #1D42BA);
    outline-offset: 2px;
    border-radius: 2px;
}

/* Remove default outline only when focus-visible handles it */
:focus:not(:focus-visible) {
    outline: none;
}

/* Input focus (already exists ‚Äî keep and standardize) */
.input-field:focus,
.textarea-field:focus {
    outline: none;
    border-color: var(--border-focus, #1D42BA);
    box-shadow: 0 0 0 3px rgba(29, 66, 186, 0.15);
}

/* Button focus */
.btn-primary:focus-visible,
.btn-secondary:focus-visible,
.btn-ghost:focus-visible {
    outline: 3px solid var(--accent-blue, #1D42BA);
    outline-offset: 2px;
}
```

---

## 2. Label-Input Association

Every input needs a programmatically associated label.

### Short Answer Questions

```html
<!-- Before (current) -->
<p>Simplify: (3x‚Åµ)(6x‚Åª¬≥)</p>
<input type="text" id="q3">

<!-- After -->
<label for="q3" class="question-text">Simplify: (3x‚Åµ)(6x‚Åª¬≥)</label>
<input type="text" id="q3" class="input-field" aria-describedby="fb3">
```

### Multi-Part Questions

```html
<fieldset class="question-parts">
    <legend class="sr-only">Question 5: Car depreciation problem</legend>
    <div class="question-part">
        <label for="q5a" class="part-label">(a) What is the initial value?</label>
        <input type="text" id="q5a" class="input-field" aria-describedby="fb5a">
    </div>
    ...
</fieldset>
```

### Screen-Reader Only Text

```css
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}
```

---

## 3. ARIA Landmarks

```html
<body>
    <header role="banner">
        <!-- Test title, timer, stripe -->
    </header>

    <nav class="progress-bar-sticky" role="navigation" aria-label="Test progress">
        <span>Question 7 of 20</span>
        <span class="streak-counter" aria-live="polite">...</span>
    </nav>

    <main role="main" aria-label="Test questions">
        <!-- Question cards -->
    </main>

    <footer role="contentinfo">
        <!-- Score card, buttons, branding -->
    </footer>
</body>
```

---

## 4. Live Regions

Dynamic content needs `aria-live` to announce changes to screen readers.

| Element | Attribute | Why |
|---------|-----------|-----|
| Score display | `aria-live="polite"` | Announces score after submission |
| Streak counter | `aria-live="polite"` | Announces streak changes |
| Timer | `aria-live="off"` | Don't announce every tick |
| Timer toast | `aria-live="assertive"` + `role="alert"` | Time warnings are important |
| Feedback area | `aria-live="polite"` | Announces correct/incorrect |
| Hint layer | `aria-live="polite"` | Announces hint content |

---

## 5. Heading Hierarchy

Every test file must follow:

```
h1: Test title ("Algebra II: Exponents")
  h2: Section headers ("Section A: Simplification")
    h3: Question numbers ("Question 1 ‚Äî Standard 1.a")
```

**Rules:**
- Exactly one `h1` per page
- No skipped levels (no h1 ‚Üí h3)
- Question numbers use h3 (currently `<h3>` ‚Äî good)
- Section dividers use h2

---

## 6. Button Accessibility

```html
<!-- Text buttons: already accessible -->
<button class="btn-primary">CHECK ANSWERS</button>

<!-- Icon-only buttons need aria-label -->
<button class="arena-toggle" aria-label="Toggle Arena Mode">üèüÔ∏è</button>
<button class="print-btn" aria-label="Print test">üñ®Ô∏è</button>

<!-- Close buttons -->
<button class="answer-key-close" aria-label="Close answer key">‚úï</button>
```

---

## 7. Color-Only Indicators

Color must never be the sole way to convey information.

| Element | Color Indicator | Text/Icon Backup |
|---------|----------------|------------------|
| Correct answer | Green border | ‚úÖ icon + "Correct" text |
| Incorrect answer | Red border | ‚úó icon + "Incorrect" text |
| Standard mastery ‚â•90% | Green bar | "‚úÖ" emoji + percentage |
| Standard needs work <50% | Red bar | "‚ö†Ô∏è" emoji + percentage |
| Timer warning | Amber text | Same ‚Äî number is the indicator |
| Timer urgent | Red text | "TIME" text replaces number |

Already specified in all component specs ‚Äî this is a verification checklist.

---

## 8. Keyboard Navigation

### Tab Order

The natural tab order should flow:
1. Timer toggle (if present)
2. Arena mode toggle (if present)
3. Question 1 input ‚Üí Question 2 input ‚Üí ... ‚Üí Question N input
4. Submit button
5. Print button
6. Answer key button

### Within Hint Layers

When a hint appears:
1. Focus moves to the hint content
2. Tab goes to "TRY AGAIN" ‚Üí "SHOW ANSWER"
3. If answer revealed, tab goes to "SHOW SOLUTION"
4. Escape closes hint layers

### Answer Key Overlay

```javascript
// Trap focus inside answer key when open
const overlay = document.querySelector('.answer-key-overlay');
overlay.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeAnswerKey();
    // Trap tab within overlay
});
// Return focus to trigger button on close
```

### Skip Link

```html
<a class="skip-link" href="#main-content">Skip to questions</a>
```

```css
.skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--accent-navy, #002D62);
    color: white;
    padding: 8px 16px;
    z-index: 100;
    transition: top 0.2s;
}
.skip-link:focus {
    top: 0;
}
```

---

## 9. Chart Accessibility

Chart.js canvases are not accessible by default. Add text alternatives:

```html
<div class="chart-container" role="img" aria-label="Score history: Test 1 40%, Test 2 60%, Test 3 75%, Test 4 88%">
    <canvas id="scoreChart"></canvas>
</div>
```

For math function plots:
```html
<div class="chart-container" role="img" aria-label="Graph of f(x) = 2x + 1, linear function with positive slope">
    <canvas id="chart6"></canvas>
</div>
```

Each chart's `aria-label` must describe the data, not just "chart."

---

## 10. Reduced Motion

```css
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}
```

This disables:
- Streak pulse animation
- Hint slide-down animation
- Score card fade-in
- Progress bar fill animation
- Chart draw animation

Users who set `prefers-reduced-motion` in their OS get instant state changes with no animation.

---

## Implementation Priority

| Priority | Item | Impact |
|----------|------|--------|
| P0 | Focus indicators (`:focus-visible`) | Keyboard users can't navigate without this |
| P0 | Label-input association (`for=`) | Screen readers can't identify inputs |
| P0 | `.sr-only` class | Foundation for hidden accessible text |
| P1 | ARIA landmarks (`role`, `aria-label`) | Screen reader navigation structure |
| P1 | Live regions on feedback/score | Dynamic content announced |
| P1 | Chart `aria-label` | Chart data accessible to screen readers |
| P1 | Skip link | Keyboard users skip repetitive header |
| P2 | Focus trapping (answer key overlay) | Modal UX for keyboard users |
| P2 | `prefers-reduced-motion` | Motion-sensitive users |
| P2 | Heading hierarchy audit | Correct nesting across 12 files |

---

## Testing (for Agent F)

- [ ] Tab through entire test without mouse ‚Äî all inputs/buttons reachable
- [ ] Focus ring visible on every interactive element
- [ ] Screen reader (NVDA or VoiceOver) reads all question text and inputs
- [ ] Score announcement after submission (aria-live)
- [ ] Chart aria-labels describe data content
- [ ] Answer key overlay traps focus, Escape closes
- [ ] Skip link appears on first Tab press
- [ ] `prefers-reduced-motion` disables all animations
- [ ] No color-only indicators (all have text/icon backup)

---

*Agent A: The P0 items (focus styles, label association, sr-only) can be added during the shared CSS/JS extraction. They're additive ‚Äî no existing behavior changes. The ARIA landmarks require modifying the HTML structure of each test file, so add those during the one-by-one migration.*
