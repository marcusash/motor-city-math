# Motor City Math ‚Äî Arena Mode (Dark Theme) Spec (D-7)

**Author:** Design Agent
**Date:** 2026-02-17
**Status:** proposed
**Priority:** P3 (backlog ‚Äî not required for core study flow)
**Blocking:** Agent A ‚Üí dark mode implementation (deferred)

---

## Concept

"Arena Mode" is an optional dark theme that mirrors the arena scoreboard vibe. It's fun, not functional ‚Äî Kai might enjoy studying in a Pistons game-day visual. It does NOT affect print output.

---

## CSS Custom Properties

The entire design system moves to CSS custom properties. Light mode is the default. Arena Mode overrides via a `.arena-mode` class on `<body>`.

### Token Map

```css
:root {
    /* Background */
    --bg-page: #F5F5F5;
    --bg-card: #FFFFFF;
    --bg-input: #FFFFFF;
    --bg-overlay: rgba(0, 0, 0, 0.5);

    /* Text */
    --text-primary: #333333;
    --text-secondary: #666666;
    --text-inverse: #FFFFFF;

    /* Brand */
    --accent-red: #C8102E;
    --accent-red-hover: #A00D24;
    --accent-blue: #1D42BA;
    --accent-blue-hover: #1535A0;
    --accent-navy: #002D62;

    /* Borders */
    --border-default: #BEC0C2;
    --border-focus: #1D42BA;
    --border-subtle: #E8E8E8;

    /* Semantic */
    --color-correct: #1B7D3A;
    --color-correct-bg: #F0FFF4;
    --color-incorrect: #C8102E;
    --color-incorrect-bg: #FFF5F5;
    --color-warning: #E8A317;
    --color-warning-bg: #FFFFF0;

    /* Shadows */
    --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.06);
    --shadow-card-hover: 0 4px 16px rgba(0, 45, 98, 0.08);

    /* Chart */
    --chart-grid: #E8E8E8;
    --chart-label: #333333;
}

/* === Arena Mode === */
body.arena-mode {
    --bg-page: #0A0E1A;
    --bg-card: #141B2D;
    --bg-input: #1A2240;
    --bg-overlay: rgba(0, 0, 0, 0.7);

    --text-primary: #E0E4EB;
    --text-secondary: #8B92A8;
    --text-inverse: #0A0E1A;

    --accent-red: #E8334A;         /* lightened for dark bg contrast */
    --accent-red-hover: #FF4D63;
    --accent-blue: #4A72E8;        /* lightened for dark bg contrast */
    --accent-blue-hover: #6B8FFF;
    --accent-navy: #002D62;        /* unchanged ‚Äî used for gradients */

    --border-default: #2A3352;
    --border-focus: #4A72E8;
    --border-subtle: #1E2742;

    --color-correct: #2ECC71;
    --color-correct-bg: #0D2818;
    --color-incorrect: #E8334A;
    --color-incorrect-bg: #2D0A12;
    --color-warning: #F5C842;
    --color-warning-bg: #2D2408;

    --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.3);
    --shadow-card-hover: 0 4px 16px rgba(74, 114, 232, 0.15);

    --chart-grid: #2A3352;
    --chart-label: #E0E4EB;
}
```

### Usage in CSS

All component CSS references tokens instead of hex values:

```css
body {
    background: var(--bg-page);
    color: var(--text-primary);
}

.question-card {
    background: var(--bg-card);
    border: 1px solid var(--border-default);
    border-left: 4px solid var(--accent-red);
    box-shadow: var(--shadow-card);
}

.input-field {
    background: var(--bg-input);
    border: 2px solid var(--border-default);
    color: var(--text-primary);
}
.input-field:focus {
    border-color: var(--border-focus);
}
```

---

## Toggle

### Button

A small icon button in the top-right corner of the header:

```html
<button class="arena-toggle" id="arenaToggle"
        aria-label="Toggle Arena Mode" title="Arena Mode">
    üèüÔ∏è
</button>
```

```css
.arena-toggle {
    position: absolute;
    top: 16px;
    right: 16px;
    background: var(--bg-card);
    border: 1px solid var(--border-default);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    font-size: 1.1em;
    cursor: pointer;
    transition: background 0.2s, border-color 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.arena-toggle:hover {
    border-color: var(--accent-blue);
}

body.arena-mode .arena-toggle {
    background: var(--accent-navy);
    border-color: var(--accent-blue);
}
```

### JS

```javascript
const toggle = document.getElementById('arenaToggle');
toggle.addEventListener('click', () => {
    document.body.classList.toggle('arena-mode');
    const isArena = document.body.classList.contains('arena-mode');
    localStorage.setItem('mcm-arena-mode', isArena ? 'on' : 'off');
});

// Restore preference on load
if (localStorage.getItem('mcm-arena-mode') === 'on') {
    document.body.classList.add('arena-mode');
}
```

---

## WCAG Contrast (Arena Mode)

| Pair | Ratio | Pass? |
|------|-------|-------|
| `--text-primary` on `--bg-card` (#E0E4EB on #141B2D) | 11.2:1 | ‚úÖ AAA |
| `--accent-red` on `--bg-card` (#E8334A on #141B2D) | 5.1:1 | ‚úÖ AA |
| `--accent-blue` on `--bg-card` (#4A72E8 on #141B2D) | 5.4:1 | ‚úÖ AA |
| `--text-secondary` on `--bg-card` (#8B92A8 on #141B2D) | 5.0:1 | ‚úÖ AA |
| `--color-correct` on `--bg-card` (#2ECC71 on #141B2D) | 8.3:1 | ‚úÖ AAA |

All pairs meet WCAG AA minimum (4.5:1 for text).

---

## Print Exclusion

Arena Mode NEVER affects print. The print stylesheet uses hardcoded colors:

```css
@media print {
    body.arena-mode {
        background: white !important;
        color: #000 !important;
    }
    /* All print rules use explicit colors, not custom properties */
}
```

---

## `prefers-color-scheme` Support

Optionally respect the OS dark mode preference:

```javascript
// Auto-enable if user hasn't manually toggled and OS is dark
const stored = localStorage.getItem('mcm-arena-mode');
if (stored === null) {
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (prefersDark) document.body.classList.add('arena-mode');
}
```

The manual toggle always overrides the OS preference.

---

## Migration Notes

Moving to CSS custom properties is a prerequisite for Arena Mode. This is a significant refactor of `shared/styles.css` ‚Äî every hex color becomes a `var(--token)`. The migration:

1. Define `:root` tokens in `shared/styles.css`
2. Replace hex values in all component CSS with `var(--token-name)`
3. Add `body.arena-mode` overrides
4. Add toggle button to header template
5. Test light mode ‚Üí identical to current
6. Test dark mode ‚Üí verify all text is readable
7. Test print ‚Üí verify unaffected

---

*Agent A: This is P3 priority ‚Äî implement after core features (grading, dashboard, question renderer) are stable. The CSS custom property migration in step 1-2 can happen earlier as part of the shared CSS extraction (A-1) without adding the dark overrides yet.*
