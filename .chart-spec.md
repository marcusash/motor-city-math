# Motor City Math — Chart Spec (D-5)

**Author:** Design Agent
**Date:** 2026-02-17
**Status:** proposed
**Implements:** Feature #9 (Progress dashboard charts), Chart.js Pistons theme
**Blocking:** Agent A → A-3 (Chart.js theme file), A-8 (Dashboard)

---

## Purpose

Two chart categories in Motor City Math:

1. **Math charts** — Function plots, scatter data, best-fit lines embedded in test questions. These already exist in 6/12 files.
2. **Progress charts** — Score history, standard mastery, time trends. These are new (dashboard + parent view).

This spec covers the unified Pistons theme for both, plus detailed configs for all progress charts.

---

## 1. Pistons Chart Theme (`shared/chart-theme.js`)

A single theme file that Agent A loads before any Chart.js instance. Sets global defaults.

### Color Tokens

```javascript
const MCM_CHART = {
    // Data series
    primary:    '#1D42BA',  // pistons-blue — main data line
    secondary:  '#C8102E',  // pistons-red — comparison/highlight
    tertiary:   '#002D62',  // navy — third series
    accent:     '#F5A623',  // streak gold — milestone markers

    // Fills (translucent versions of above)
    primaryFill:   'rgba(29, 66, 186, 0.08)',
    secondaryFill: 'rgba(200, 16, 46, 0.08)',

    // Semantic
    correct:    '#1B7D3A',
    incorrect:  '#C8102E',
    warning:    '#E8A317',

    // UI
    grid:       '#E8E8E8',
    gridDark:   '#2A3352',  // Arena Mode
    label:      '#333333',
    labelLight: '#E0E4EB',  // Arena Mode
    target:     '#BEC0C2',  // target/threshold line
    tooltip:    '#002D62',
    tooltipText:'#FFFFFF',

    // Font
    fontFamily: "'Helvetica Neue', Helvetica, Arial, sans-serif"
};
```

### Global Defaults

```javascript
Chart.defaults.font.family = MCM_CHART.fontFamily;
Chart.defaults.font.size = 13;
Chart.defaults.color = MCM_CHART.label;
Chart.defaults.plugins.legend.display = false;  // hide by default, enable per-chart
Chart.defaults.plugins.tooltip.backgroundColor = MCM_CHART.tooltip;
Chart.defaults.plugins.tooltip.titleFont = { weight: '700', size: 13 };
Chart.defaults.plugins.tooltip.bodyFont = { size: 12 };
Chart.defaults.plugins.tooltip.padding = 10;
Chart.defaults.plugins.tooltip.cornerRadius = 4;
Chart.defaults.plugins.tooltip.displayColors = false;
Chart.defaults.elements.point.radius = 5;
Chart.defaults.elements.point.hoverRadius = 7;
Chart.defaults.elements.line.borderWidth = 3;
Chart.defaults.elements.line.tension = 0;  // straight lines by default
Chart.defaults.responsive = true;
Chart.defaults.maintainAspectRatio = false;
```

### Arena Mode Support

The theme file exports a function to swap palettes:

```javascript
function setChartMode(mode) {
    const dark = mode === 'arena';
    Chart.defaults.color = dark ? MCM_CHART.labelLight : MCM_CHART.label;
    // Individual charts read grid color on render
}
```

---

## 2. Score History Chart (Dashboard)

The primary dashboard chart. Shows score trend across test attempts for the current unit.

### Type: Line

```
  100% ┤                                          ●  88%
   80% ┤                              ●
   60% ┤                  ●
   40% ┤      ●
   20% ┤
    0% ┼──────┴───────────┴───────────┴───────────┴──────
        Test 1       Test 2       Test 3       Test 4
        Jan 15       Jan 19       Jan 22       Jan 26
```

### Config

```javascript
{
    type: 'line',
    data: {
        labels: ['Jan 15', 'Jan 19', 'Jan 22', 'Jan 26'],
        datasets: [{
            data: [40, 60, 75, 88],
            borderColor: MCM_CHART.primary,
            backgroundColor: MCM_CHART.primaryFill,
            fill: true,
            pointBackgroundColor: MCM_CHART.primary,
            pointBorderColor: '#FFFFFF',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8,
            tension: 0.3  // slight curve for organic feel
        }]
    },
    options: {
        scales: {
            y: {
                min: 0,
                max: 100,
                ticks: {
                    stepSize: 20,
                    callback: v => v + '%'
                },
                grid: { color: MCM_CHART.grid }
            },
            x: {
                grid: { display: false }
            }
        },
        plugins: {
            tooltip: {
                callbacks: {
                    label: ctx => `${ctx.parsed.y}% · ${ctx.raw.correct}/${ctx.raw.total}`
                }
            },
            // Target line plugin (80% threshold)
            annotation: {
                annotations: {
                    target: {
                        type: 'line',
                        yMin: 80,
                        yMax: 80,
                        borderColor: MCM_CHART.target,
                        borderWidth: 1,
                        borderDash: [6, 4],
                        label: {
                            content: '80%',
                            display: true,
                            position: 'end',
                            font: { size: 11 },
                            color: MCM_CHART.target
                        }
                    }
                }
            }
        }
    }
}
```

### Behavior

- **Max 10 points visible.** If more tests, show last 10 with horizontal scroll indicator.
- **Point label on last point:** Score percentage displayed to right of final dot.
- **Target line:** Dashed line at 80% (chrome color). Label "80%" right-aligned.
- **Empty state:** No chart. Show centered text: "No scores yet. Take your first test."
- **Single test:** Show one point with no line. Score label visible.
- **Animation:** Line draws left-to-right, 0.8s ease-out. Points pop in (scale 0→1) as line reaches them.

### Responsive Sizing

| Breakpoint | Height | Padding |
|-----------|--------|---------|
| Desktop (>1000px) | 250px | 20px |
| Tablet (768-999px) | 220px | 16px |
| Phone (480-767px) | 200px | 12px |
| Small phone (<480px) | 180px | 8px |

---

## 3. Math Function Charts (Existing — Theme Update)

These exist in 6 files. The theme update replaces the current color palette with Pistons colors. No layout changes.

### Color Migration

| Current | New | Used For |
|---------|-----|----------|
| `#e74c3c` (red) | `#C8102E` (pistons-red) | Primary dataset |
| `#8B1E3F` (burgundy) | `#1D42BA` (pistons-blue) | Secondary dataset |
| `#667eea` (blue) | `#1D42BA` (pistons-blue) | Alt primary |
| `#764ba2` (purple) | `#002D62` (navy) | Tertiary |
| `#f59e0b` (amber) | `#F5A623` (streak gold) | Highlight |

### Axes & Grid

```javascript
// Shared axis config for math plots
const mathAxisConfig = {
    grid: { color: MCM_CHART.grid, lineWidth: 1 },
    ticks: { color: MCM_CHART.label, font: { size: 12 } },
    title: { color: MCM_CHART.label, font: { size: 13, weight: '600' } }
};
```

### Function Plot Datasets

When plotting f(x), g(x), h(x):
- **f(x):** pistons-blue `#1D42BA`, solid line, 3px
- **g(x):** pistons-red `#C8102E`, solid line, 3px
- **h(x):** navy `#002D62`, dashed line, 2px
- **Data points:** pistons-red `#C8102E`, radius 5, white border

### Best-Fit Lines

- **Scatter points:** pistons-red `#C8102E`, radius 5
- **Best-fit line:** pistons-blue `#1D42BA`, 2px, dashed `[6, 4]`
- **Fill:** none (scatter plots don't fill)

---

## 4. Standard Mastery Mini-Charts (Dashboard)

Small inline visualizations inside standard cards. These are CSS progress bars, not Chart.js — simpler, lighter, more responsive.

Specced in `.scorecard-spec.md` → Standard Cards section. No Chart.js needed.

---

## 5. Parent Dashboard Charts (Future — D-5b)

When the parent dashboard is built (Feature #16), it will need:

1. **Score timeline** — Line chart, same as student dashboard but showing all units (multi-series).
2. **Time spent per test** — Bar chart. X = test name, Y = minutes. Pistons-blue bars.
3. **Per-standard heatmap** — Grid of colored cells (red/yellow/green) showing mastery across all standards.

These will be specced separately when Feature #16 is prioritized. The theme file should support them.

### Parent Multi-Series Line

```javascript
// Multiple units on one chart
datasets: [
    { label: 'Exponents', borderColor: MCM_CHART.primary, data: [...] },
    { label: 'Linear',    borderColor: MCM_CHART.secondary, data: [...] },
    { label: 'Non-Linear', borderColor: MCM_CHART.tertiary, data: [...] }
]
// Legend enabled for multi-series
plugins: { legend: { display: true, position: 'top' } }
```

### Time Spent Bar

```javascript
{
    type: 'bar',
    data: {
        labels: ['Exp v1', 'Exp v2', 'Exp v3', 'Exam'],
        datasets: [{
            data: [45, 38, 32, 41],
            backgroundColor: MCM_CHART.primary,
            borderRadius: 4,
            maxBarThickness: 40
        }]
    },
    options: {
        scales: {
            y: {
                ticks: { callback: v => v + ' min' }
            }
        }
    }
}
```

---

## 6. Chart Container CSS

Standardize all chart wrappers:

```css
.chart-container {
    position: relative;
    padding: 16px;
    background: #FFFFFF;
    border: 1px solid #BEC0C2;
    border-radius: 8px;
    margin-bottom: 24px;
}

.chart-container canvas {
    width: 100% !important;
}

/* Desktop */
.chart-container--score-history { height: 250px; }
.chart-container--math-plot { height: 350px; }
.chart-container--bar { height: 200px; }

/* Phone */
@media (max-width: 768px) {
    .chart-container--score-history { height: 200px; }
    .chart-container--math-plot { height: 280px; }
    .chart-container--bar { height: 180px; }
}

@media (max-width: 480px) {
    .chart-container--score-history { height: 180px; }
    .chart-container--math-plot { height: 250px; }
    .chart-container--bar { height: 160px; }
    .chart-container { padding: 8px; }
}
```

---

## 7. Print Handling

Charts in test questions print. Dashboard charts don't.

### Test Math Charts (print)

```css
@media print {
    .chart-container--math-plot {
        height: auto !important;
        min-height: 250px;
        border: 1px solid #000;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        page-break-inside: avoid;
    }
    .chart-container--math-plot canvas {
        filter: none;  /* keep colors — grayscale loses data clarity */
    }
}
```

### Dashboard Charts (no print)

```css
@media print {
    .chart-container--score-history,
    .chart-container--bar {
        display: none;
    }
}
```

---

## 8. Animation

| Chart | Animation | Duration | Easing |
|-------|-----------|----------|--------|
| Score history line | Draw left→right | 0.8s | ease-out |
| Score history points | Scale 0→1 as line passes | 0.3s each | ease-out |
| Math function plots | Draw left→right | 0.5s | linear |
| Bar chart | Grow from bottom | 0.6s | ease-out |

### Disable on `prefers-reduced-motion`

```javascript
const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
Chart.defaults.animation = prefersReduced ? false : {
    duration: 800,
    easing: 'easeOutQuart'
};
```

---

## 9. Tooltip Format

All tooltips follow the same structure:

```
┌────────────────────────┐
│  Test 3                │  bold title
│  75% · 15/20 · 38 min │  stats line
└────────────────────────┘
```

- **Background:** navy `#002D62`
- **Text:** white
- **Corner radius:** 4px
- **Padding:** 10px
- **No color swatch** (displayColors: false)
- **Position:** nearest point, above when possible

---

## 10. Empty States

| Chart | Empty State |
|-------|------------|
| Score history (no tests) | Gray dashed border box. Centered: "No scores yet. Take your first test." |
| Score history (1 test) | Single point, no line. Score label next to point. |
| Math plot (no data) | Should never happen — data is hardcoded in questions. |
| Bar chart (no data) | Gray dashed border box. Centered: "No data yet." |

### CSS for empty chart

```css
.chart-empty {
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px dashed #BEC0C2;
    border-radius: 8px;
    color: #666;
    font-size: 0.95em;
    min-height: 180px;
}
```

---

*Agent A: The theme file (`shared/chart-theme.js`) should export `MCM_CHART` colors and set `Chart.defaults`. Load it before any chart instantiation. Existing math charts need color migration per §3. New dashboard charts use configs from §2 and §5.*
