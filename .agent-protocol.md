# Motor City Math â€” Agent Protocol

> Communication rules for multi-agent collaboration on this project.
> Every agent reads this file on startup. Violations create merge conflicts and wasted work.

---

## 1. Organization Structure

Motor City Math operates under two orgs:

- **Forge** â€” Marcus's leadership team. Reviews, mentors, architects, tackles hardest problems across all projects. Agents float between projects.
- **Grind** â€” Learning tools org. MCM is the first project. Dedicated builders.

Agent IDs use the format `{org-prefix}{role-initial}`. See `.agent-comms/README.md` for the full roster.

### Grind Agents (MCM)

| ID | Name | Primary Responsibility |
|----|------|----------------------|
| GA | grind-application | Build system, shared components, test templates, dashboard, grading engine |
| GR | grind-research | Question bank, math accuracy, curriculum alignment, pedagogy, spaced repetition |
| GD | grind-design | Visual design, CSS, responsive, accessibility, print layout, interaction specs |
| GF | grind-fundamentals | Testing, answer validation, grading accuracy, edge cases, print QA, regression |
| GS | grind-security | Data integrity, localStorage schema, save/load, offline-first, progress tracking |
| GP | grind-platform | Agent coordination, repo structure, CI/CD, docs, taskboards, README |
| GI | grind-importer | PDF import, OCR, content conversion, worksheet parsing, data pipelines |

### Forge Leadership (cross-project)

| ID | Name | Primary Responsibility |
|----|------|----------------------|
| FA | forge-application | Chief Architect â€” architecture decisions, code reviews, hardest problems |
| FD | forge-design | Design Director â€” design system, brand language, UX reviews |
| FF | forge-fundamentals | Quality Lead â€” test strategy, coverage standards, CI/CD patterns |
| FP | forge-platform | Security & Ops Lead â€” infrastructure, agent comms, repo ops |
| FR | forge-research | Research Lead â€” voice/tone optimization, AI models, prompt engineering |
| ID | forge-data | Data & Identification Lead â€” data pipelines, M365, identity mining |

---

## 2. Shared Files

| File | Maintainer | Purpose |
|------|-----------|---------|
| `.agents.md` | P | Agent registry, file ownership, rules |
| `.agent-status.md` | Each agent (own section) | Live task tracking, blockers, deliverables |
| `.agent-protocol.md` | P | This file â€” communication rules |
| `.marcus-queue.md` | All agents (write), Marcus (read) | Items needing Marcus's input or decision |
| `.design-system.md` | D | Visual specs, color palette, components, layout |
| `.voice-guide.md` | D | Copy/tone guidelines, ADHD-aware feedback, Pistons voice |
| `.project-review.md` | D | Project inventory, architecture, opportunities |
| `README.md` | P | Public-facing project description |

---

## 3. Status Board Format

Every agent maintains their section in `.agent-status.md` using this format:

```markdown
## {Agent Name} Status
_{Scope description}_

> **Executive Summary:** {1-2 sentence status}

- [x] TASK-ID: Description â€” DONE âœ… {details}
- [ ] TASK-ID: Description â€” {status}
- [ ] TASK-ID: Description â€” BLOCKED on {what}

### Findings
- {severity emoji} {finding description}

### Cross-Agent Requests
- For Agent {X}: {specific request}
```

Task IDs use format: `{agent-letter}-{number}` (e.g., A-1, R-3, F-7)

---

## 4. File Ownership Rules

- **Read any file.** All files are readable by all agents.
- **Write only owned files.** Check `.agents.md` â†’ File Ownership table.
- **Request changes to others' files** via `.agent-status.md` â†’ Cross-Agent Requests.
- **Shared files** (`.agent-status.md`, `.marcus-queue.md`) â€” write only your section.
- **New files**: Claim ownership by adding to `.agents.md` before creating.

---

## 4b. Git Rules (ALL Agents â€” Read This)

**Identity:** All commits use Marcus's global git identity (`Marcus Ash <marcusash@microsoft.com>`). This is configured at the system level and must not be changed.

**DO NOT:**
- Run `git config user.name` or `git config user.email` â€” ever
- Modify `.git/config` directly for any reason
- Set agent-specific identities (e.g., `agent-a@motorcitymath.local`)
- Run `git config` to change any setting without posting a request to Agent P first

**WHY:** A fake local git identity (`agent-a@motorcitymath.local`) caused Agent A's commits to fail silently in autopilot mode. The email wasn't associated with any GitHub account, and Copilot CLI couldn't prompt for confirmation. This blocked Agent A for an entire work session.

**IF `git commit` FAILS:** Post a commit request in your Cross-Agent Requests section of `.agent-status.md` with:
1. The exact files changed
2. A commit message following Â§11 conventions
3. Agent P will commit on your behalf

**Commit trailer:** Always include at the end of every commit message:
```
Co-authored-by: Copilot <223556219+Copilot@users.noreply.github.com>
```

---

## 5. Communication Channels

### Agent â†’ Agent
Post in `.agent-status.md` under "Cross-Agent Requests" with:
```
For Agent {X}: {specific request}
Context: {why you need it}
Blocking: {what it blocks, or "non-blocking"}
```

### Agent â†’ Marcus
Post in `.marcus-queue.md` with severity:
- ðŸ”´ **BLOCKER** â€” Cannot proceed without Marcus's input
- ðŸŸ¡ **DECISION** â€” Need a choice between options
- ðŸŸ¢ **FYI** â€” Informational, no action needed

### Marcus â†’ Agents
Marcus writes in `.marcus-queue.md` or directly in `.agent-status.md` under the relevant agent's section.

---

## 6. Delivery Protocol

### Delivering Content (questions, data)
- Format: JSON with schema documented in a companion `.schema.md` file
- Filename prefix: `.` for agent-generated files (e.g., `.question-bank-draft.json`)
- After delivery: Post "DONE âœ…" in status board with file path

### Delivering Code (HTML, CSS, JS)
- Must work in browser (no build step required for v1)
- Must pass: (a) opens without console errors, (b) print layout works, (c) auto-grading gives correct results
- After delivery: Post commit hash + what changed in status board

### Delivering Specs (design, architecture)
- Format: Markdown with `.` prefix (e.g., `.dashboard-spec.md`)
- Include: wireframe (ASCII), behavior description, edge cases
- After delivery: Tag receiving agent in Cross-Agent Requests

---

## 7. Bug Reports

File bugs in `.agent-status.md` â†’ Bugs section:

```markdown
### Bugs

| ID | Severity | Description | File | Owner | Status |
|----|----------|-------------|------|-------|--------|
| B-1 | high | Grading accepts "x=3" but not "3" | index.html | A | open |
```

Severity levels:
- `blocker` â€” Cannot ship. Data loss or math error.
- `high` â€” Wrong answer accepted/rejected, broken grading.
- `medium` â€” UX issue, layout broken on a device.
- `low` â€” Cosmetic, typo, minor polish.

**Math errors are always `blocker` severity.** A wrong answer in an answer key means a student learns the wrong thing.

---

## 8. Quality Gates

Before marking any task DONE:

1. **Opens in browser** â€” No console errors, no 404s for CDN resources
2. **Grading works** â€” If the file has auto-grading, submit correct answers and verify score
3. **Print works** â€” `Ctrl+P` shows clean layout, no buttons, page breaks work
4. **Math renders** â€” All equations display correctly (KaTeX or plain text)
5. **Mobile works** â€” Resize browser to 375px width, verify nothing is cut off
6. **Answers are correct** â€” Research agent has verified every answer in the answer key

---

## 8b. Taskboard Refresh Schedule

Agents update `.agent-status.md` at these checkpoints:

| When | What to Update |
|------|---------------|
| **After each completed task** | Mark `[x]`, add details, post deliverable path |
| **When blocked** | Mark BLOCKED with reason + which agent/decision is needed |
| **When filing bugs** | Add to Bugs table with severity, file, repro steps |
| **Cross-agent requests** | Post in your Cross-Agent Requests section immediately |
| **Questions for Marcus** | Post in `.marcus-queue.md` with severity emoji |

**Read before writing:** Always pull/read `.agent-status.md` before updating to avoid overwriting another agent's changes.

---

## 9. Execution Order

### Phase 1: Foundation
1. **P** sets up agent infrastructure (this file, status board, protocol)
2. **D** finalizes design system (`.design-system.md` already done)
3. **R** audits all 200 existing questions for accuracy
4. **A** extracts shared CSS/JS from existing 12 files

### Phase 2: Core Features
5. **A** builds auto-grading engine (shared `scripts.js`)
6. **R** builds question bank JSON (`data/questions.json`)
7. **A** creates test template that consumes JSON + shared CSS/JS
8. **D** specs dashboard layout
9. **F** writes grading validation tests

### Phase 3: Product
10. **A** builds dashboard (`index.html`)
11. **A** implements per-standard scoring
12. **R** adds difficulty ratings + spaced repetition logic
13. **S** builds progress tracking (localStorage schema)
14. **D** implements responsive + dark mode

### Phase 4: Scale
15. **R** + **A** build randomized practice mode
16. **R** adds hint system + step-by-step solutions
17. **A** builds test builder (custom test from question bank)
18. **F** regression tests on all existing tests

---

## 10. Project-Specific Rules

1. **No build tools in v1.** The project works by opening HTML files in a browser. Keep it that way. A build system can come in v2 if needed.
2. **Offline-first.** CDN dependencies (KaTeX, Chart.js) must have local fallback or be bundled. Kai studies on the bus without WiFi.
3. **Math accuracy is a blocker.** Every question, answer, hint, and step-by-step solution must be mathematically verified by the Research agent before shipping.
4. **Print is a first-class feature.** Every test must produce a clean printable version. Teachers and students still use paper.
5. **Kai is 15 and has ADHD.** The voice is coach-like, not patronizing. Copy must be clear, short, and motivating â€” never wordy. See `.design-system.md` Â§14 and `.voice-guide.md` for copy guidelines.
6. **Standards-based.** All questions map to SAAS curriculum standards. This alignment is maintained by the Research agent.

---

## 10b. File Naming Conventions

### New Files

All new files use **kebab-case** with lowercase:

| Type | Pattern | Example |
|------|---------|---------|
| Test HTML | `{unit}-{topic}-{variant}.html` | `unit1-exponents-v1.html` |
| Spec docs | `.{feature}-spec.md` | `.dashboard-spec.md` |
| Agent docs | `.agent-{letter}-{topic}.md` | `.agent-r-onboarding-message.md` |
| Shared code | `{purpose}.{ext}` | `styles.css`, `scripts.js` |
| Data files | `{content}.json` | `questions.json`, `standards.json` |

### Existing Files

**Do NOT rename existing test HTML files** until Agent A migrates them to `tests/`. The current filenames (`index.html`, `quiz_251117.html`, `20260119_Exponents_Unit1.html`) stay as-is â€” Kai may have bookmarks or habits tied to them.

### Migration Mapping (reference for Agent A)

| Current | Target |
|---------|--------|
| `20260119_Exponents_Unit1.html` | `tests/unit1-exponents/v1.html` |
| `20260119_Exponents_Unit1_2nd.html` | `tests/unit1-exponents/v2.html` |
| `20260119_Exponents_Unit1_3rd.html` | `tests/unit1-exponents/v3.html` |
| `exponents_exam.html` | `tests/unit1-exponents/exam.html` |
| `index.html` | `tests/unit2-linear-functions/practice.html` |
| `index_calc.html` | `tests/unit2-linear-functions/practice-calc.html` |
| `final_exam_251123.html` | `tests/unit2-linear-functions/final.html` |
| `final_exam_251123_mini.html` | `tests/unit2-linear-functions/final-mini.html` |
| `quiz_251117.html` | `tests/unit2-linear-functions/quiz-inverse.html` |
| `quiz_251120.html` | `tests/unit3-exponential/quiz-1.html` |
| `quiz_251121.html` | `tests/unit3-exponential/quiz-2.html` |
| `nonlinear_functions_test.html` | `tests/unit4-nonlinear/test.html` |

---

## 11. Commit Message Conventions

### Format

```
type(scope): description

[optional body]

Co-authored-by: Copilot <223556219+Copilot@users.noreply.github.com>
```

### Types

| Type | Use |
|------|-----|
| `feat` | New feature or capability |
| `fix` | Bug fix |
| `refactor` | Code change that doesn't add a feature or fix a bug |
| `style` | CSS, design system changes |
| `docs` | Documentation only |
| `test` | Adding or updating tests |
| `chore` | Repo maintenance, .gitignore, CI config |
| `status` | Agent status board updates |

### Scopes

Use the agent ID or feature area: `(GA)`, `(GR)`, `(GD)`, `(GF)`, `(GS)`, `(GP)`, `(GI)`, `(FA)`, `(dashboard)`, `(grading)`, `(questions)`, etc.

### Examples

```
feat(A): extract shared CSS to shared/styles.css
fix(grading): accept "3" and "x=3" as equivalent answers
docs(P): add commit conventions to agent protocol
status(D): mark D-3 dashboard spec done
chore(P): enhance .gitignore with editor and archive patterns
```

### Rules

1. **One file per commit** when migrating existing tests (verify works before next commit)
2. **Always include the Co-authored-by trailer** for Copilot-assisted commits
3. **Reference task IDs** in the description when applicable (e.g., "A-1: extract shared CSS")
4. **Keep subject line under 72 characters**

---

*Adapted from the Inkwell agent protocol (6 agents, 18 rounds of bug fixes, 529 tests).*

---

## 12. Agent Communication (Inbox System)

Every agent has a message inbox at `.agent-comms/{org}/inbox-{ID}/`. Messages are JSON files with a defined schema.

### Workflow

After EVERY completed task:
1. **Check your inbox:** look for `.json` files in your inbox folder
2. **Process unread messages** (highest priority first)
3. **Update your section** in `.agent-status.md`
4. **If your work unblocks another agent**, send them an inbox message

### Sending Messages

1. Create a `.json` file following the schema in `.agent-comms/README.md`
2. Place it in the recipient's inbox folder
3. Filename format: `{YYYYMMDD}-{HHMM}-from-{your-ID}-{slug}.json`
4. Commit the message file (it's part of the repo)

### Cross-Project Messages

To message a Forge leadership agent: drop the message in `.agent-comms/forge/inbox-{ID}/`

Forge agents messaging Grind agents: commit to this repo at `.agent-comms/grind/inbox-{ID}/`

Set `"project"` field in the JSON to identify context (`"mcm"`, `"inkwell"`, `"dispatch"`).

### Processing Messages

1. Read the message and do what it asks
2. Move the `.json` file from your inbox to `.agent-comms/outbox/`
3. If the message needs a response, send one back to the sender

### Rules

1. **Never delete messages** â€” move to `outbox/` after processing
2. **One message per file** â€” don't batch multiple requests
3. **Include file paths** when referencing deliverables
4. **Set priority honestly** â€” `critical` means someone is literally blocked on you
5. **Check inbox after EVERY task** â€” this is mandatory
