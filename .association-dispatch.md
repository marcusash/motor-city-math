# üèÄ Association Theme ‚Äî Task Dispatch

**From:** Marcus (Human Lead)
**Date:** 2026-02-18
**Status:** APPROVED ‚Äî All agents begin work

---

## Context

The "Association" light theme redesign is approved. Mockups reviewed. FA (Staff Engineer) reviewed and flagged 5 gaps ‚Äî all answered by Agent D. No blockers remain.

**Design source:** `docs/mockups/` (3 PNGs) + `docs/mockups/generate-mockups.js` (token values)
**Full review thread:** `.design-review-request.md`

---

## Task Assignments by Agent

### üîß Agent FA ‚Äî Staff Engineer / Architect

You review, architect, and sign off. You do not implement.

| Task | What | Depends On | Deliverable |
|------|------|------------|-------------|
| **fa-t4-arch-canvas** | Architect canvas simplification | ‚Äî (START NOW) | Implementation notes: simplified `getCanvasColors()`, MutationObserver deletion plan, white fillRect pattern for A to copy into 6 files |
| **fa-t1-review-tokens** | Review A's token implementation | A completes a-t1-tokens | Sign-off: all 8 values match spec, `--grid-minor` added to both `:root` and `body.arena-mode` |
| **fa-t5-review-final** | Final code review of all A's changes | A completes a-t4a, a-t4b, a-t5 | Sign-off: no regressions, canvas simplified, hex migrated, ready for QA |

**Start now:** `fa-t4-arch-canvas` ‚Äî write the canvas architecture notes so A can execute.

---

### üî® Agent A ‚Äî Application Engineer

You implement. Follow D's CSS specs and FA's architecture notes.

| Task | What | Depends On | File(s) |
|------|------|------------|---------|
| **a-t1-tokens** | Token refresh: 8 values + 1 new | ‚Äî (START NOW) | `shared/styles.css` |
| **a-t2-stripe** | Jersey stripe motif | a-t1 + fa-t1-review + d-t2-spec | `shared/styles.css` |
| **a-t3-qnumbers** | Question number restyle | a-t1 + fa-t1-review + d-t2-spec | `shared/styles.css` |
| **a-t4a-canvas-mvp** | Graph canvas fix ‚Äî MVP exam | a-t1 + fa-t4-arch | `nonlinear_exam_mvp.html` ‚ö†Ô∏è SMALL EDITS ONLY |
| **a-t4b-canvas-other** | Graph canvas fix ‚Äî 5 other files | a-t4a | 5 legacy HTML files |
| **a-t5-hex-migrate** | Hardcoded hex migration | a-t1 | `parent.html`, `test-builder.html`, `nonlinear_exam_mvp.html` |

**Start now:** `a-t1-tokens` ‚Äî 8 value swaps + 1 new token in `shared/styles.css :root` + `body.arena-mode`.

**‚ö†Ô∏è Critical:** `nonlinear_exam_mvp.html` is 70KB. Large multiline edits truncate it. Use small, targeted replacements. Verify file size after each edit. Keep `git checkout HEAD --` ready.

**Token values (exact):**

| Token | Current | New |
|-------|---------|-----|
| `--bg-page` | `#F5F5F5` | `#F4F5F9` |
| `--bg-input` | `#FFFFFF` | `#F8F9FC` |
| `--text-primary` | `#333333` | `#1A1F36` |
| `--text-secondary` | `#666666` | `#5E6378` |
| `--border-default` | `#BEC0C2` | `#C8CCD8` |
| `--border-subtle` | `#E8E8E8` | `#E2E5EF` |
| `--shadow-card` | `rgba(0,0,0,0.06)` | `rgba(0,45,98,0.06)` |
| `--bg-highlight` | `#f0f4ff` | `#EEF1FA` |
| **NEW** `--grid-minor` | ‚Äî | `#EDF0F5` (light) / `#1E2742` (dark) |

---

### üé® Agent D ‚Äî Design

You spec the visual details for A to implement, then update docs after.

| Task | What | Depends On | Deliverable |
|------|------|------------|-------------|
| **d-t2-spec** | CSS spec: stripe motif + question numbers | ‚Äî (START NOW) | Exact CSS: selectors, values, gradient syntax, hover states |
| **d-t6-designsys** | Bump .design-system.md to v3.0 | a-t2, a-t3, a-t4a done | Updated design system doc |
| **d-t8-template-audit** | Unified template audit | All QA done | Visual consistency report |

**Start now:** `d-t2-spec` ‚Äî write the exact CSS for the jersey stripe and question number restyle so A can implement T2 and T3.

---

### üî¨ Agent R ‚Äî Research / Math

| Task | What | Depends On | Deliverable |
|------|------|------------|-------------|
| **r-t4-verify** | Verify canvas changes preserve math accuracy | A completes a-t4a + a-t4b | Confirmation: axes correct, click-to-plot works, scoring unchanged, all questions grade correctly |

**Wait for:** A to finish canvas work, then verify. Color changes should not affect math ‚Äî this is a safety check.

---

### üß™ Agent F ‚Äî QA

| Task | What | Depends On | Deliverable |
|------|------|------------|-------------|
| **f-t7-light** | QA all 19 pages ‚Äî light mode | FA final review + R verification | Pass/fail checklist per file |
| **f-t7-dark** | QA all pages ‚Äî Arena Mode | f-t7-light | Pass/fail dark mode |
| **f-t7-responsive** | Responsive spot-check 375px + 768px | f-t7-light | 6 key pages at mobile + tablet |

**Wait for:** All implementation + reviews complete, then run full QA pass.

---

## Execution Order (Critical Path)

```
NOW (parallel):
  A  ‚Üí a-t1-tokens (implement)
  FA ‚Üí fa-t4-arch-canvas (architect)
  D  ‚Üí d-t2-spec (spec)

AFTER T1 + FA REVIEW:
  A  ‚Üí a-t2-stripe, a-t3-qnumbers (parallel, need d-t2-spec)
  A  ‚Üí a-t4a-canvas-mvp (needs fa-t4-arch)
  A  ‚Üí a-t5-hex-migrate

AFTER T4a:
  A  ‚Üí a-t4b-canvas-other

AFTER ALL A WORK:
  FA ‚Üí fa-t5-review-final
  R  ‚Üí r-t4-verify

AFTER REVIEW + VERIFY:
  F  ‚Üí f-t7-light ‚Üí f-t7-dark ‚Üí f-t7-responsive
  D  ‚Üí d-t6-designsys

FOLLOW-UP:
  D  ‚Üí d-t8-template-audit
```

---

## Locked Decisions (Do Not Revisit)

- Light mode is default. Arena Mode (dark) stays.
- Canvas is **always white** ‚Äî even in Arena Mode ("whiteboard in dark room").
- Dark tokens unchanged except new `--grid-minor: #1E2742`.
- Print styles stay hardcoded ‚Äî intentional.
- Legacy file hex cleanup is out of scope (token propagation handles 80%).
- Pistons official palette only: Red `#C8102E`, Blue `#1D42BA`, Navy `#002D62`, Chrome `#BEC0C2`, White `#FFFFFF`.

---

**Update your section in `.agent-status.md` as you complete tasks. Small commits. Verify before marking done.**

‚Äî Marcus

---

## ‚úÖ fa-t4-arch-canvas ‚Äî Canvas Architecture Notes (from FA)

**Date:** Feb 18, 2026 1:15am
**For:** Agent A ‚Äî follow these notes for a-t4a and a-t4b

### The Problem

Canvas elements don't inherit CSS ‚Äî they render pixels directly. Currently:
- MVP exam (`nonlinear_exam_mvp.html`) has `getCanvasColors()` that reads CSS vars via `getComputedStyle()`, plus a MutationObserver to redraw when Arena Mode toggles. **This is over-engineered for the new design.**
- Legacy files (`nonlinear_functions_test.html`, `linear_functions_test.html`, `quiz_251120.html`, `quiz_251121.html`, `final_exam_251123.html`) have hardcoded `#ddd` grid / `#000` axes / `#333` labels.

### The New Architecture: Canvas Is Always White

Per Marcus's locked decision: canvas background is always white, even in Arena Mode. This means **we don't need theme-aware canvas colors anymore.** The canvas is a "whiteboard in a dark room."

**Simplification:**

1. **Delete `getCanvasColors()` entirely** from `nonlinear_exam_mvp.html`
2. **Delete the MutationObserver** (lines ~1490-1493) ‚Äî no need to redraw on theme toggle since canvas colors are static
3. **Use hardcoded constants** ‚Äî this is correct now because canvas doesn't change with theme:

```javascript
// Canvas drawing constants ‚Äî always white background, navy/gray lines
var CANVAS = {
    bg:        '#FFFFFF',
    gridMajor: '#D8DCE6',
    gridMinor: '#EDF0F5',
    axis:      '#002D62',   // navy ‚Äî strong, readable
    label:     '#002D62',   // navy ‚Äî matches axes
    blue:      '#1D42BA',   // plotted curves, asymptotes
    correct:   '#1B7D3A',
    incorrect: '#C8102E',
    pointStroke: '#FFFFFF'  // white ring around points
};
```

4. **Add white fill as first line of `drawGrid()`:**
```javascript
ctx.fillStyle = CANVAS.bg;
ctx.fillRect(0, 0, d.w, d.h);
```

5. **Replace all `c.grid`, `c.axis`, `c.label` references** with `CANVAS.gridMajor`, `CANVAS.axis`, `CANVAS.label` etc.

### Implementation Guide for a-t4a (MVP exam)

**File:** `nonlinear_exam_mvp.html`
**‚ö†Ô∏è SMALL EDITS ONLY ‚Äî file is 70KB. One targeted replacement at a time.**

Step-by-step:

1. **Replace `getCanvasColors()` function** (lines ~954-965) with the `CANVAS` constant object above. Put it right before `drawGrid()`.

2. **In `drawGrid()`** (starts ~line 967):
   - After `ctx.clearRect(0, 0, d.w, d.h);` add: `ctx.fillStyle = CANVAS.bg; ctx.fillRect(0, 0, d.w, d.h);`
   - Minor gridlines: change `ctx.strokeStyle = c.grid` to `ctx.strokeStyle = CANVAS.gridMinor`
   - Remove `ctx.globalAlpha = 0.35` / `ctx.globalAlpha = 1.0` ‚Äî minor lines already have distinct color, no need for alpha hack
   - Major gridlines: change `ctx.strokeStyle = c.grid` to `ctx.strokeStyle = CANVAS.gridMajor`
   - Axes: change `ctx.strokeStyle = c.axis` to `ctx.strokeStyle = CANVAS.axis`
   - Labels: change `ctx.fillStyle = c.label` to `ctx.fillStyle = CANVAS.label`

3. **In `redrawGraph()`** (starts ~line 1010):
   - Change all `c.blue` ‚Üí `CANVAS.blue`
   - Change `c.correct` ‚Üí `CANVAS.correct`
   - Change `c.incorrect` ‚Üí `CANVAS.incorrect`
   - Change `c.pointStroke` ‚Üí `CANVAS.pointStroke`

4. **Delete the MutationObserver block** (~lines 1490-1493):
   ```javascript
   // DELETE THIS:
   new MutationObserver(function() {
       redrawGraph('graphQ12');
       redrawGraph('graphQ13');
   }).observe(document.body, { attributes: true, attributeFilter: ['class'] });
   ```

5. **Verify:** Open the file, toggle Arena Mode. Canvas should stay white with navy axes in both modes.

### Implementation Guide for a-t4b (5 legacy files)

Each legacy file has its own `drawGrid()` with hardcoded colors. The pattern is the same for all:

**Files:**
- `nonlinear_functions_test.html` ‚Äî 3 separate canvas instances (lines ~552, ~1076, ~1192)
- `linear_functions_test.html` ‚Äî 1 canvas instance (line ~825)
- `quiz_251120.html` ‚Äî canvas drawing
- `quiz_251121.html` ‚Äî canvas drawing
- `final_exam_251123.html` ‚Äî canvas drawing

**For each file:**

1. Add the `CANVAS` constant object at the top of the `<script>` block (before the first `drawGrid`)
2. Add `ctx.fillStyle = CANVAS.bg; ctx.fillRect(0, 0, width, height);` as first line of each `drawGrid()`
3. Replace `'#ddd'` ‚Üí `CANVAS.gridMajor`
4. Replace `'#000'` ‚Üí `CANVAS.axis` (in axes section)
5. Replace `'#333'` ‚Üí `CANVAS.label` (in labels section)
6. Replace any point colors with `CANVAS.correct` / `CANVAS.incorrect` / `CANVAS.blue`

**No MutationObserver needed** in legacy files since canvas is static.

### What NOT to Change

- **Click-to-plot math** ‚Äî all coordinate calculations (pixel ‚Üî grid conversion) are unchanged
- **Scoring/grading logic** ‚Äî `checkGraph()` compares grid coordinates, not pixels or colors
- **Canvas dimensions** ‚Äî keep `width="500" height="500"` on MVP, keep whatever legacy files have
- **Print `@media` blocks** ‚Äî leave hardcoded print styles alone

### Summary

| Before | After |
|--------|-------|
| `getCanvasColors()` reads CSS vars at render time | Static `CANVAS` constant ‚Äî no DOM reads |
| MutationObserver redraws on theme toggle | Deleted ‚Äî canvas doesn't change with theme |
| `globalAlpha` hack for minor gridlines | Distinct `gridMinor` vs `gridMajor` colors |
| Dark mode: canvas inherits dark card bg | White fillRect always ‚Äî "whiteboard in dark room" |
| Legacy files: `#ddd`, `#000`, `#333` | Same `CANVAS` constant as MVP |

**Net effect: simpler code, better readability, consistent across all 6 canvas files.**

‚Äî FA

---

## Appendix: Agent D CSS Spec ‚Äî Stripe Motif + Question Numbers (d-t2-spec)

**From:** Agent D (Design)
**For:** Agent A (Application) ‚Äî implement these exact styles
**Date:** 2026-02-18

### 1. Jersey Stripe Motif ‚Äî Header

Replace the current solid red `border-bottom` on `header` and `.answer-key-title` with the red-blue-red stripe gradient.

**Current (line 190):**
```css
header {
    border-bottom: 3px solid var(--accent-red);
}
```

**New:**
```css
header {
    border-bottom: 4px solid;
    border-image: linear-gradient(
        to right,
        var(--accent-red) 0%, var(--accent-red) 30%,
        var(--accent-blue) 30%, var(--accent-blue) 70%,
        var(--accent-red) 70%, var(--accent-red) 100%
    ) 1;
}
```

Apply the same to `.answer-key-title` (line 463) ‚Äî same `border-bottom` + `border-image`.

**Arena Mode override** ‚Äî Add to `body.arena-mode`:
```css
body.arena-mode header,
body.arena-mode .answer-key-title {
    border-image: linear-gradient(
        to right,
        var(--accent-red) 0%, var(--accent-red) 30%,
        var(--accent-blue) 30%, var(--accent-blue) 70%,
        var(--accent-red) 70%, var(--accent-red) 100%
    ) 1;
}
```
(Dark mode uses the brighter `--accent-red: #E8334A` and `--accent-blue: #4A72E8` tokens automatically.)

### 2. Jersey Stripe Motif ‚Äî Question Card Left Border

**Current (line 216):**
```css
.question-card {
    border-left: 4px solid var(--accent-red);
}
```

**New:**
```css
.question-card {
    border-left: 4px solid;
    border-image: linear-gradient(
        to bottom,
        var(--accent-red) 0%, var(--accent-red) 30%,
        var(--accent-blue) 30%, var(--accent-blue) 70%,
        var(--accent-red) 70%, var(--accent-red) 100%
    ) 1;
}
```

**Note:** Direction is `to bottom` (vertical stripe, like the jersey side panel). The `border-image` only applies to `border-left` because other borders are `1px solid var(--border-default)`.

**Answered states override the stripe** ‚Äî keep existing:
```css
.question-card.answered-correct {
    border-left-color: var(--color-correct);
    border-image: none;
}
.question-card.answered-incorrect {
    border-left-color: var(--color-incorrect);
    border-image: none;
}
```

Same pattern for `.answer-item` (line 471) ‚Äî replace `border-left: 4px solid var(--accent-red)` with the vertical stripe.

### 3. Question Number Restyle

**Current (line 235):**
```css
.question-number {
    color: var(--accent-blue);
    font-weight: 600;
    font-size: 1.2em;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 1px;
}
```

**New:**
```css
.question-number {
    color: var(--accent-navy);
    font-weight: 800;
    font-size: 1.3em;
    margin-bottom: 16px;
    padding-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-bottom: 2px solid var(--border-subtle);
}
```

**What changed and why:**
- `color`: `--accent-blue` ‚Üí `--accent-navy` ‚Äî darker, more authority, matches jersey wordmark
- `font-weight`: 600 ‚Üí 800 ‚Äî bolder, jersey number energy
- `font-size`: 1.2em ‚Üí 1.3em ‚Äî slightly larger for hierarchy
- `letter-spacing`: 1px ‚Üí 0.08em ‚Äî proportional spacing, wider feel
- `padding-bottom: 10px` ‚Äî NEW, breathing room before separator
- `border-bottom: 2px solid var(--border-subtle)` ‚Äî NEW, clean separator line between number and question text
- `margin-bottom`: 15px ‚Üí 16px ‚Äî snap to 8px grid

**Arena Mode:** No override needed ‚Äî `--accent-navy` already maps to `#A0B8E8` (light blue) in dark mode, `--border-subtle` maps to `#1E2742`. Both are readable.

### 4. Summary of Selectors Changed

| Selector | Property | Old | New |
|----------|----------|-----|-----|
| `header` | `border-bottom` | `3px solid var(--accent-red)` | `4px solid` + stripe `border-image` |
| `.answer-key-title` | `border-bottom` | `3px solid var(--accent-red)` | `4px solid` + stripe `border-image` |
| `.question-card` | `border-left` | `4px solid var(--accent-red)` | `4px solid` + vertical stripe `border-image` |
| `.question-card.answered-correct` | ‚Äî | (no change) | Add `border-image: none` |
| `.question-card.answered-incorrect` | ‚Äî | (no change) | Add `border-image: none` |
| `.answer-item` | `border-left` | `4px solid var(--accent-red)` | `4px solid` + vertical stripe `border-image` |
| `.question-number` | multiple | blue, 600wt, no separator | navy, 800wt, bottom separator |

### 5. No Hover/Active State Changes

The existing `hover` on `.question-card` (box-shadow only) is unaffected. No new hover states needed for stripe or question numbers.

‚Äî Agent D
